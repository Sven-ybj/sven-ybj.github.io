<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DEMO</title>

</head>
<body>

<script type="text/javascript">
    window._RNchannel={};

    function scanQrCode(params){

        params={};
        params.error=function(data){

        }
        params.callback=function(data){
            alert(data)
        }
        params.data={
            name:"111",
            age:"222"
        }
        params.data.channelId="channel"+Date.now();
        params.data.actionType="scanQrCode";

        window._RNchannel[params.data.channelId] = params;

        postMessageToReactNative(params.data)
    }

    function postMessageToReactNative(data){
        if (window.originalPostMessage) {
            window.postMessage(JSON.stringify(data));
        } else {
            throw Error('postMessage接口还未注入');
        }
    }
    document.addEventListener('message', function (e) {
        var data = e.data;
        try{
            alert(typeof data)
            alert(data)
            alert(data.data)
            data = JSON.parase(data);
            alert(typeof data)
            if(window._RNchannel[data.channelId]){
                window._RNchannel[data.channelId].callback(data.data);
                delete window._RNchannel[data.channelId]
            }
        }catch(e){
            alert("error")
        }
    });
</script>
<div id="app2">
    <button>扫描二维码3</button>
</div>
<script type="text/javascript">
      document.getElementsByTagName('button')[0].addEventListener('click', function() {
          scanQrCode()
    });
</script>
</body>
</html>
