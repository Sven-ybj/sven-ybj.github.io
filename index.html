<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DEMO</title>

</head>
<body>

<script type="text/javascript">
    window._RNchannel={};

    function scanQrCode(params){

        params=params||{};
        params.error=function(data){
            alert("error"+data.message)
        }
        params.callback=function(data){
            alert(data.code)
        }
        params.data={
            name:"111",
            age:"222"
        }

        sendData(params,"scanQrCode");
    }

    function getPushId(params){

        params=params||{};
        params.error=function(data){
            alert("error"+data.message)
        }
        params.callback=function(data){
            alert(data.id)
        }

        sendData(params,"getPushId");
    }

    function weChatShare(params){

        params=params||{};
        params.error=function(data){
            alert("error"+data.message)
        }
        params.callback=function(data){
            alert(data)
        }

        sendData(params,"weChatShare");
    }
    function aliPay(params){

        params=params||{};
        params.error=function(data){
            alert("error"+data.message)
        }
        params.callback=function(data){
            alert(data)
        }

        sendData(params,"aliPay");
    }

    function sendData(params,actionType){
        params=params||{};
        params.data=params.data||{};

        params.data.channelId="channel"+Date.now();
        params.data.actionType=actionType;

        window._RNchannel[params.data.channelId] = params;

        postMessageToReactNative(params.data)
    }

    function postMessageToReactNative(data){
        if (window.originalPostMessage) {
            window.postMessage(JSON.stringify(data));
        } else {
            throw Error('postMessage接口还未注入');
        }
    }
    document.addEventListener('message', function (e) {
        var data = e.data;
        try{
            data = JSON.parse(data).data;
            if(window._RNchannel[data.channelId]){
                if(data.status == "fail"){
                    window._RNchannel[data.channelId].error(data);
                }else{
                    window._RNchannel[data.channelId].callback(data);
                }

                //delete 
                delete window._RNchannel[data.channelId]
            }
        }catch(e){
            alert(e.message)
        }
    });
</script>
<div id="app2">
    <button id="getUserAgent">getUserAgent</button><br/><br/>
    <button id="scanQrCode">扫描二维码</button><br/><br/>
    <button id="pushId">获取推送唯一ID</button><br/><br/>
    <button id="weChatShare">微信分享-发送给朋友-纯文本消息</button><br/><br/>
    <button id="weChatShare1">微信分享-发送给朋友-分享图文链接</button><br/><br/>
    <button id="weChatShare2">微信分享-分享到朋友圈-纯文本消息</button><br/><br/>
    <button id="weChatShare3">微信分享-分享到朋友圈-分享图文链接</button><br/><br/>
    <button id="aliPay">支付宝支付(APP生成假数据)</button><br/><br/>
    <button id="aliPay1">支付宝支付(传入接口数据)</button><br/><br/>
</div>
<script type="text/javascript">
    document.getElementById('scanQrCode').addEventListener('click', function() {
        scanQrCode()
    });

    document.getElementById('pushId').addEventListener('click', function() {
        getPushId()
    });
    document.getElementById('getUserAgent').addEventListener('click', function() {
        alert(navigator.userAgent)
    });
    document.getElementById('weChatShare').addEventListener('click', function() {
        
        weChatShare({
            data:{
                shareType:"toSession",//发送给朋友
                type:"text",
                description:"微信分享-发送给朋友-纯文本消息"
            }
        });
    });
    document.getElementById('weChatShare1').addEventListener('click', function() {
        weChatShare({
            data:{
                shareType:"toSession",//发送给朋友
                type:"news",
                title:"微信好友测试的链接",
                description:"微信分享-发送给朋友-分享链接",
                thumbImage:"https://mmbiz.qlogo.cn/mmbiz_png/Ml65nrvICLZJtmdN1kXlvWOaHtKGcGPCURJEYLp3aX9N3bsysLl3eBcWmZQbysUD7Wicg8xqLF9FenK2IibAOKMw/0?wx_fmt=png",
                webpageUrl:"http://www.youxuanyisheng.com/#/index"
            }
        });
    });
    document.getElementById('weChatShare2').addEventListener('click', function() {
        weChatShare({
            data:{
                shareType:"toTimeline",//分享到朋友圈
                type:"text",
                description:"微信分享-发送给朋友-纯文本消息"
            }
        });
    });
    document.getElementById('weChatShare3').addEventListener('click', function() {
        weChatShare({
            data:{
                shareType:"toTimeline",//分享到朋友圈
                type:"news",
                title:"微信好友测试的链接",
                description:"微信分享-发送给朋友-分享链接",
                thumbImage:"https://mmbiz.qlogo.cn/mmbiz_png/Ml65nrvICLZJtmdN1kXlvWOaHtKGcGPCURJEYLp3aX9N3bsysLl3eBcWmZQbysUD7Wicg8xqLF9FenK2IibAOKMw/0?wx_fmt=png",
                webpageUrl:"http://www.youxuanyisheng.com/#/index"
            }
        });
    });
    document.getElementById('aliPay').addEventListener('click', function() {
        aliPay();
    });
    document.getElementById('aliPay1').addEventListener('click', function() {
        aliPay({
            data:{
                payData:"charset=utf-8&biz_content=%7B%22timeout_express%22%3A%2230m%22%2C%22product_code%22%3A%22QUICK_MSECURITY_PAY%22%2C%22total_amount%22%3A%220.01%22%2C%22subject%22%3A%221%22%2C%22body%22%3A%22%E6%88%91%E6%98%AF%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%22%2C%22out_trade_no%22%3A%22918283219%22%7D&method=alipay.trade.app.pay&app_id=2018061760412485&sign_type=RSA2&version=1.0&timestamp=2016-07-29+16%3A55%3A53&sign=LEYjHGPwoLh0ibfPuJLMfrjqAf1lospBUDJdKg1lYBJEMqEqeV1AxYcSMBuGHGBxEPdCAm5DG1pAj5UI%2Fa4HV4rdtowwR3MP7LOxUdjh8S1HKXXa9T2JAU8G1tyKunTpkRDRr4U17WNDf9iyLe3EMqhQQ%2Bx621Vz9gyJ0bf3qe9XJ2MESWZXDmZ3Sh7ZBYC0jPJd75wX5Q4UdUtiLTVO7izuhoQe1SYUfCnfRTUd%2BmnvB2B2E8TrZpps%2FVG00ipxUvcKHyaJPPZ%2FsrOR9toPTo2mkUslEeHLmr7g%2FKdLjzAD%2B9GwWthAvjFaw6BC0a9vSp2ocGE5PfuCw1Cr05Nu3g%3D%3D"
            }
        });
    });
</script>
</body>
</html>
